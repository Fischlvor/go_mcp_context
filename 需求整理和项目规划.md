# éœ€æ±‚æ•´ç†å’Œé¡¹ç›®è§„åˆ’

## ä¸€ã€æ ¸å¿ƒç›®æ ‡

**æ„å»ºä¸€ä¸ªç§æœ‰åŒ–çš„ Context7 æ›¿ä»£æ–¹æ¡ˆ**ï¼Œä¸ºä¼ä¸šå†…ç½‘çš„ CoStrict AI IDE æä¾›ï¼š
1. **å®æ—¶ã€å‡†ç¡®çš„æŠ€æœ¯æ–‡æ¡£å’Œä»£ç ç¤ºä¾‹**ï¼ˆé€šè¿‡å‘é‡æ£€ç´¢ï¼‰
2. **æ ‡å‡† MCP åè®®æ¥å£**ï¼ˆè®© IDE æ— ç¼é›†æˆï¼‰
3. **æ”¯æŒæ‰‹åŠ¨ä¸Šä¼ æ–‡æ¡£**ï¼ˆé€‚åº”å†…ç½‘éš”ç¦»åœºæ™¯ï¼‰

---

## äºŒã€å…³é”®ç†è§£ç‚¹

### 2.1 Context7 çš„æ ¸å¿ƒèƒ½åŠ›ï¼ˆéœ€è¦å¤åˆ¶çš„ï¼‰

| èƒ½åŠ› | Context7 åšæ³• | æœ¬é¡¹ç›®æ–¹æ¡ˆ |
|------|-------------|---------|
| **æ–‡æ¡£æ£€ç´¢** | å‘é‡åŒ– + å‘é‡æœç´¢ | PostgreSQL + pgvector |
| **æ™ºèƒ½æ’åº** | 5 æŒ‡æ ‡é‡æ’åº | ç®€åŒ–ç‰ˆ 3 æŒ‡æ ‡ |
| **ç‰ˆæœ¬ç®¡ç†** | æ”¯æŒåº“çš„å¤šä¸ªç‰ˆæœ¬ | åŒæ ·æ”¯æŒ |
| **MCP æ¥å£** | ä¸¤ä¸ªå·¥å…·ï¼ˆsearch/getï¼‰ | åŒæ ·å®ç° |
| **ç¼“å­˜ä¼˜åŒ–** | Redis å¤šå±‚ç¼“å­˜ | åŒæ ·å®ç° |

### 2.2 Context7 ä¸æœ¬æ–¹æ¡ˆçš„ä¸»è¦å·®å¼‚

| ç»´åº¦ | Context7 | æœ¬é¡¹ç›® |
|------|---------|--------|
| **æ•°æ®æº** | è‡ªåŠ¨çˆ¬å– GitHub/NPM | **æ‰‹åŠ¨ä¸Šä¼ æ–‡æ¡£** |
| **éƒ¨ç½²æ–¹å¼** | äº‘æœåŠ¡ï¼ˆUpstashï¼‰ | **ç§æœ‰åŒ–éƒ¨ç½²** |
| **ç½‘ç»œç¯å¢ƒ** | äº’è”ç½‘ | **å†…ç½‘éš”ç¦»** |
| **æ–‡æ¡£æ ¼å¼** | ä¸»è¦æ˜¯ Markdown | **å¤šæ ¼å¼ï¼ˆPDF/DOCX/Swaggerï¼‰** |
| **Embedding** | äº‘ç«¯ API | **æœ¬åœ°æˆ– OpenAI API** |

---

## ä¸‰ã€ç³»ç»Ÿæ¶æ„

### 3.1 ä¸‰å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         CoStrict IDE (MCP Client)       â”‚
â”‚  ç”¨æˆ·åœ¨ IDE ä¸­æé—® â†’ MCP åè®®è¯·æ±‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚ MCP Protocol (HTTP/SSE)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       MCP Server (Go + mcp-golang)      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚search-libs   â”‚  â”‚get-library   â”‚    â”‚
â”‚  â”‚åº“ååŒ¹é…      â”‚  â”‚æ–‡æ¡£æ£€ç´¢      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Business Logic Layer (Go)           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ å‘é‡æ£€ç´¢ + é‡æ’åº + ç¼“å­˜         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Storage Layer                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚PostgreSQL    â”‚  â”‚Redis         â”‚    â”‚
â”‚  â”‚+ pgvector    â”‚  â”‚Cache         â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ä¸¤ä¸ªæ ¸å¿ƒæµç¨‹

#### æµç¨‹ 1ï¼šæ–‡æ¡£ä¸Šä¼ å’Œå¤„ç†

```
ç”¨æˆ·ä¸Šä¼ æ–‡æ¡£
  â†“
æ ¼å¼è¯†åˆ« (PDF/DOCX/MD/Swagger)
  â†“
æ–‡æœ¬æå– (docconv/gomarkdown)
  â†“
è¯­ä¹‰åˆ†å— (512 tokens + 50 overlap)
  â†“
ç”Ÿæˆ Embedding (OpenAI API)
  â†“
å­˜å‚¨åˆ° PostgreSQL + pgvector
  â†“
Web ç•Œé¢æ˜¾ç¤º"ä¸Šä¼ æˆåŠŸ"
```

#### æµç¨‹ 2ï¼šCoStrict æŸ¥è¯¢æ–‡æ¡£

```
CoStrict IDE ç”¨æˆ·æé—®
  â†“
MCP è¯·æ±‚ â†’ search-libraries (åº“ååŒ¹é…)
  â†“
MCP è¯·æ±‚ â†’ get-library-docs (æ–‡æ¡£æ£€ç´¢)
  â†“
ç”ŸæˆæŸ¥è¯¢å‘é‡
  â†“
PostgreSQL å‘é‡æœç´¢ (Top-50)
  â†“
ç®€åŒ–é‡æ’åº (3 æŒ‡æ ‡)
  â†“
è¿”å› Top-10 ç»“æœç»™ IDE
  â†“
IDE å°†æ–‡æ¡£æ³¨å…¥åˆ° LLM ä¸Šä¸‹æ–‡
  â†“
LLM åŸºäºå‡†ç¡®æ–‡æ¡£ç”Ÿæˆä»£ç 
```

---

## å››ã€æŠ€æœ¯æ ˆ

### 4.1 åç«¯æŠ€æœ¯æ ˆ

| ç»„ä»¶ | é€‰å‹ | å…³é”®ç†ç”± |
|------|------|---------|
| **Web æ¡†æ¶** | Gin | é«˜æ€§èƒ½ã€ç”Ÿæ€æˆç†Ÿ |
| **MCP SDK** | mcp-golang | ç”Ÿäº§çº§ã€ç±»å‹å®‰å…¨ |
| **æ•°æ®åº“** | PostgreSQL 15 | ç»Ÿä¸€å­˜å‚¨ã€ACID ä¿è¯ |
| **å‘é‡æ‰©å±•** | pgvector | æ€§èƒ½ä¼˜å¼‚ï¼ˆ11.4x ååé‡ï¼‰ |
| **Embedding** | OpenAI text-embedding-3-small | æˆæœ¬æä½ï¼ˆ$0.02/1M tokensï¼‰ |
| **ç¼“å­˜** | Redis | å¤šå±‚ç¼“å­˜çƒ­é—¨æŸ¥è¯¢ |
| **æ–‡æ¡£è§£æ** | docconv + gomarkdown + go-openapi | å¤šæ ¼å¼æ”¯æŒ |
| **ORM** | GORM | ç±»å‹å®‰å…¨ã€æ˜“äºç»´æŠ¤ |

### 4.2 å‰ç«¯æŠ€æœ¯æ ˆ

```
Vue 3 + TypeScript + Vite
â”œâ”€â”€ æ–‡æ¡£ä¸Šä¼ ç•Œé¢
â”œâ”€â”€ åº“ç®¡ç†ç•Œé¢ï¼ˆç‰ˆæœ¬ã€å…ƒæ•°æ®ï¼‰
â”œâ”€â”€ æ£€ç´¢æµ‹è¯•ç•Œé¢
â””â”€â”€ ç»Ÿè®¡åˆ†æç•Œé¢
```

**å‰ç«¯ä¾èµ–ï¼š**
- vue@3.x - æ ¸å¿ƒæ¡†æ¶
- vue-router@4.x - è·¯ç”±ç®¡ç†
- pinia@2.x - çŠ¶æ€ç®¡ç†
- axios - HTTP è¯·æ±‚
- element-plus - UI ç»„ä»¶åº“
- vite - æ„å»ºå·¥å…·

### 4.3 éƒ¨ç½²æ–¹æ¡ˆ

```yaml
docker-compose.yml:
  - PostgreSQL 15 (+ pgvector)
  - Redis
  - Go MCP Server
  - Vue 3 å‰ç«¯
  - Nginx åå‘ä»£ç†
```

---

## äº”ã€æ ¸å¿ƒåŠŸèƒ½æ‹†è§£

### 5.1 MCP Serverï¼ˆæœ€å…³é”®ï¼‰

#### å·¥å…· 1ï¼šsearch-libraries

**åŠŸèƒ½ï¼šåº“åæœç´¢å’Œç‰ˆæœ¬æŸ¥è¯¢**

```go
// è¾“å…¥å‚æ•°
{
  "libraryName": "react"  // åº“åæŸ¥è¯¢å­—ç¬¦ä¸²
}

// å¤„ç†æµç¨‹
1. æ¨¡ç³ŠåŒ¹é…åº“åï¼ˆLevenshtein è·ç¦» â‰¥80%ï¼‰
2. å‰ç¼€åŒ¹é…ä¼˜å…ˆï¼ˆ"react" åŒ¹é… "react-dom"ï¼‰
3. å‘é‡æœç´¢è¡¥å……ï¼ˆåº“æè¿°å‘é‡æœç´¢ï¼‰
4. è¿”å›åº“åˆ—è¡¨ + å¯ç”¨ç‰ˆæœ¬

// è¾“å‡ºæ ¼å¼
{
  "results": [
    {
      "id": "/react/18.3.0",
      "title": "React",
      "description": "A JavaScript library for building user interfaces",
      "versions": ["18.2.0", "18.3.0"],
      "totalSnippets": 150,
      "benchmarkScore": 95,
      "trustScore": "High"
    }
  ]
}
```

**å…³é”®å‚æ•°ï¼š**
- æ¨¡ç³ŠåŒ¹é…é˜ˆå€¼ï¼šâ‰¥80%ï¼ˆLevenshtein è·ç¦»ï¼‰
- ä¼˜å…ˆçº§ï¼šå‰ç¼€åŒ¹é… > Levenshtein åŒ¹é… > å‘é‡æœç´¢

---

#### å·¥å…· 2ï¼šget-library-docs

**åŠŸèƒ½ï¼šæ–‡æ¡£å†…å®¹æ£€ç´¢å’Œæ··åˆæœç´¢**

```go
// è¾“å…¥å‚æ•°
{
  "context7CompatibleLibraryID": "/react/18.3.0",  // åº“ ID
  "mode": "code",                                   // code æˆ– info
  "topic": "hooks",                                 // å¯é€‰ä¸»é¢˜è¿‡æ»¤
  "page": 1                                         // é¡µç ï¼ˆ1-10ï¼‰
}

// å¤„ç†æµç¨‹
1. ç”ŸæˆæŸ¥è¯¢å‘é‡ï¼ˆOpenAI Embeddingï¼‰
2. å‘é‡æœç´¢ï¼šPostgreSQL + pgvector (Top-50)
3. å…³é”®è¯æœç´¢ï¼šPostgreSQL å…¨æ–‡æœç´¢ (Top-50)
4. æ··åˆæœç´¢ï¼šåˆå¹¶ç»“æœï¼Œå»é‡
5. é‡æ’åºï¼š3 ä¸ªæŒ‡æ ‡
   - å‘é‡ç›¸ä¼¼åº¦ï¼š50%
   - BM25 åˆ†æ•°ï¼š30%
   - æ–‡æ¡£çƒ­åº¦ï¼š20%
6. Redis ç¼“å­˜æ£€æŸ¥
7. è¿”å› Top-10 ç»“æœï¼ˆç¬¬ (page-1)*10 åˆ° page*10ï¼‰

// è¾“å‡ºæ ¼å¼
{
  "results": [
    {
      "chunk_id": "doc_123_chunk_5",
      "content": "useEffect is a React Hook that lets you perform side effects in function components...",
      "source": "react/18.3.0/hooks.md",
      "similarity_score": 0.92,
      "relevance_score": 0.88,
      "metadata": {
        "line_start": 100,
        "line_end": 120,
        "code_language": "javascript"
      }
    }
  ],
  "total": 50,
  "page": 1,
  "limit": 10,
  "has_more": true
}
```

**å…³é”®å‚æ•°ï¼š**
- modeï¼šæ”¯æŒ "code"ï¼ˆAPI å‚è€ƒ + ä»£ç ç¤ºä¾‹ï¼‰å’Œ "info"ï¼ˆæ¦‚å¿µæŒ‡å—ï¼‰
- pageï¼š1-10ï¼ˆIDE å¯è¯·æ±‚å¤šé¡µè·å–æ›´å¤šä¸Šä¸‹æ–‡ï¼‰
- limitï¼šå›ºå®š 10ï¼ˆæ¯é¡µ 10 æ¡ç»“æœï¼‰
- é‡æ’åºæƒé‡ï¼š0.5 + 0.3 + 0.2ï¼ˆå‘é‡æƒé‡æœ€é«˜ï¼‰

### 5.2 å‰ç«¯åŠŸèƒ½è®¾è®¡

**å‰ç«¯é¡µé¢å‚è€ƒ Context7ï¼ˆhttps://context7.comï¼‰**

#### é¡µé¢ 1ï¼šåº“ç®¡ç†é¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åº“ç®¡ç†                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æœç´¢æ¡†ï¼š[Search library...]             â”‚
â”‚                                          â”‚
â”‚  æ ‡ç­¾é¡µï¼šPopular | Trending | Recent    â”‚
â”‚                                          â”‚
â”‚  åº“åˆ—è¡¨ï¼š                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ React                               â”‚â”‚
â”‚  â”‚ æ¥æºï¼š/vercel/react                 â”‚â”‚
â”‚  â”‚ Tokens: 538K | Snippets: 1.8K      â”‚â”‚
â”‚  â”‚ æ›´æ–°æ—¶é—´ï¼š3 å°æ—¶å‰                  â”‚â”‚
â”‚  â”‚ [åˆ é™¤] [æŸ¥çœ‹æ–‡æ¡£]                   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ Next.js                             â”‚â”‚
â”‚  â”‚ ...                                 â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                          â”‚
â”‚  [+ æ·»åŠ åº“] æŒ‰é’®                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åŠŸèƒ½ï¼š**
- æ˜¾ç¤ºåº“åˆ—è¡¨ï¼ˆåç§°ã€ç‰ˆæœ¬ã€æ–‡æ¡£æ•°ã€æ›´æ–°æ—¶é—´ï¼‰
- æœç´¢åº“
- åˆ é™¤åº“
- ä¸Šä¼ æ–°åº“

#### é¡µé¢ 2ï¼šæ–‡æ¡£ä¸Šä¼ é¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¸Šä¼ æ–‡æ¡£                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åº“åï¼š[React]                           â”‚
â”‚  ç‰ˆæœ¬ï¼š[18.3.0]                          â”‚
â”‚  æè¿°ï¼š[å¯é€‰]                            â”‚
â”‚                                          â”‚
â”‚  æ–‡ä»¶é€‰æ‹©ï¼š[é€‰æ‹©æ–‡ä»¶] (PDF/MD/DOCX)     â”‚
â”‚                                          â”‚
â”‚  å¤„ç†è¿›åº¦ï¼š                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ âœ“ æ–‡ä»¶ä¸Šä¼ å®Œæˆ                      â”‚â”‚
â”‚  â”‚ â³ æ–‡æœ¬è§£æä¸­... (50%)               â”‚â”‚
â”‚  â”‚ â³ åˆ†å—å¤„ç†ä¸­...                    â”‚â”‚
â”‚  â”‚ â³ Embedding ç”Ÿæˆä¸­...              â”‚â”‚
â”‚  â”‚ â³ å­˜å‚¨åˆ°æ•°æ®åº“ä¸­...                â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                          â”‚
â”‚  [ä¸Šä¼ ] [å–æ¶ˆ]                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åŠŸèƒ½ï¼š**
- é€‰æ‹©æ–‡ä»¶ï¼ˆæ”¯æŒ PDFã€Markdownã€DOCXã€Swaggerï¼‰
- è¾“å…¥åº“åå’Œç‰ˆæœ¬
- SSE å®æ—¶æ˜¾ç¤ºå¤„ç†è¿›åº¦
- æ˜¾ç¤ºå¤„ç†æ­¥éª¤å’Œè¿›åº¦ç™¾åˆ†æ¯”

#### é¡µé¢ 3ï¼šæœç´¢æµ‹è¯•é¡µé¢

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœç´¢æµ‹è¯•                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é€‰æ‹©åº“ï¼š[React 18.3.0]                 â”‚
â”‚  æŸ¥è¯¢ï¼š[è¾“å…¥æŸ¥è¯¢è¯...]                   â”‚
â”‚  [æœç´¢]                                  â”‚
â”‚                                          â”‚
â”‚  æœç´¢ç»“æœï¼ˆå…± 50 æ¡ï¼‰ï¼š                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ 1. useEffect ä½¿ç”¨æŒ‡å—               â”‚â”‚
â”‚  â”‚    æ¥æºï¼šreact/18.3.0/hooks.md      â”‚â”‚
â”‚  â”‚    ç›¸å…³æ€§ï¼š0.92 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘           â”‚â”‚
â”‚  â”‚    useEffect æ˜¯ä¸€ä¸ª React Hook...   â”‚â”‚
â”‚  â”‚    [æŸ¥çœ‹æºæ–‡ä»¶]                     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ 2. useContext ç”¨æ³•                  â”‚â”‚
â”‚  â”‚    æ¥æºï¼šreact/18.3.0/hooks.md      â”‚â”‚
â”‚  â”‚    ç›¸å…³æ€§ï¼š0.85 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘           â”‚â”‚
â”‚  â”‚    useContext æ˜¯ä¸€ä¸ª React Hook...  â”‚â”‚
â”‚  â”‚    [æŸ¥çœ‹æºæ–‡ä»¶]                     â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                          â”‚
â”‚  [ä¸Šä¸€é¡µ] ç¬¬ 1 é¡µ / 5 [ä¸‹ä¸€é¡µ]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åŠŸèƒ½ï¼š**
- é€‰æ‹©åº“å’Œç‰ˆæœ¬
- è¾“å…¥æŸ¥è¯¢
- æ˜¾ç¤ºæœç´¢ç»“æœï¼ˆåŒ…å«ç›¸å…³æ€§åˆ†æ•°ï¼‰
- åˆ†é¡µæ˜¾ç¤ºï¼ˆæ¯é¡µ 10 æ¡ï¼‰
- æŸ¥çœ‹æºæ–‡ä»¶é“¾æ¥

---

### 5.3 æ–‡æ¡£å¤„ç†æµç¨‹

#### è§£ææ¨¡å—

```go
type DocumentParser interface {
    Parse(filePath string) ([]string, error)  // è¿”å›æ–‡æœ¬å—
}

// å®ç°å¤šç§æ ¼å¼
- MarkdownParser
- PDFParser (docconv)
- DocxParser (docconv)
- SwaggerParser (go-openapi)
```

#### åˆ†å—æ¨¡å—

```go
type Chunker interface {
    Chunk(text string) []Chunk  // 512 tokens + 50 overlap
}

type Chunk struct {
    Text      string
    StartPos  int
    EndPos    int
}
```

#### Embedding æ¨¡å—

```go
type EmbeddingService interface {
    Embed(texts []string) ([][]float32, error)
}

// å®ç°
- OpenAIEmbedding (API è°ƒç”¨)
- LocalEmbedding (bge-m3 æœ¬åœ°æ¨¡å‹)
```

### 5.3 æ£€ç´¢æµç¨‹

#### å‘é‡æ£€ç´¢

```sql
SELECT id, title, content, 
       1 - (embedding <=> query_embedding) AS similarity
FROM document_chunks
WHERE library_id = ? 
  AND 1 - (embedding <=> query_embedding) > 0.5
ORDER BY embedding <=> query_embedding
LIMIT 50;
```

#### æ··åˆæœç´¢å’Œé‡æ’åº

**æœç´¢ç­–ç•¥ï¼šæ··åˆæœç´¢ï¼ˆå‘é‡ + å…³é”®è¯ï¼‰**

```
å‘é‡æœç´¢ (Top-50)          å…³é”®è¯æœç´¢ (Top-50)
     â†“                          â†“
  cosine ç›¸ä¼¼åº¦            BM25 åˆ†æ•°
     â†“                          â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚    åˆå¹¶ç»“æœï¼Œå»é‡             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  é‡æ’åºï¼ˆ3 ä¸ªæŒ‡æ ‡ï¼‰           â”‚
  â”‚  1. å‘é‡ç›¸ä¼¼åº¦ (50%)          â”‚
  â”‚  2. BM25 åˆ†æ•° (30%)           â”‚
  â”‚  3. æ–‡æ¡£çƒ­åº¦ (20%)            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  è¿”å› Top-10 ç»“æœ             â”‚
  â”‚  (ç¬¬ (page-1)*10 åˆ° page*10)  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é‡æ’åºå…¬å¼ï¼š**

```go
final_score = 0.5 * vector_similarity + 0.3 * bm25_score + 0.2 * popularity_score

// å…¶ä¸­ï¼š
// vector_similarity: å‘é‡ä½™å¼¦ç›¸ä¼¼åº¦ (0-1)
// bm25_score: PostgreSQL å…¨æ–‡æœç´¢çš„ BM25 åˆ†æ•°ï¼Œå½’ä¸€åŒ–åˆ° (0-1)
// popularity_score: æ–‡æ¡£çƒ­åº¦ = access_count / max_access_count (0-1)
```

**å…³é”®è®¾è®¡ï¼š**
- å‘é‡æƒé‡æœ€é«˜ï¼ˆ50%ï¼‰ï¼šè¯­ä¹‰æœç´¢æ˜¯æ ¸å¿ƒ
- BM25 æƒé‡æ¬¡ä¹‹ï¼ˆ30%ï¼‰ï¼šå…³é”®è¯åŒ¹é…è¡¥å……
- çƒ­åº¦æƒé‡æœ€ä½ï¼ˆ20%ï¼‰ï¼šè¾…åŠ©æ’åºå› å­
- æ–‡æ¡£çƒ­åº¦ï¼šè®¿é—®æ¬¡æ•° / æœ€å¤§è®¿é—®æ¬¡æ•°ï¼ˆæ— æ—¶é—´è¡°å‡ï¼‰

---

## å…­ã€éåŠŸèƒ½éœ€æ±‚

### 6.1 æ€§èƒ½ç›®æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ | å®ç°æ–¹å¼ |
|------|------|---------|
| **æ–‡æ¡£æ›´æ–°** | 1 åˆ†é’Ÿå†…å®Œæˆä¸€ä¸ªåº“ | å¼‚æ­¥å¤„ç† + æ‰¹é‡ Embedding |
| **æ£€ç´¢å»¶è¿Ÿ** | 1 ç§’å†…è¿”å›ç»“æœ | Redis ç¼“å­˜ + pgvector ç´¢å¼• |
| **ååé‡** | æ”¯æŒå¹¶å‘æŸ¥è¯¢ | PostgreSQL å¯è¾¾ 1500+ QPS |

### 6.2 å¯æ‰©å±•æ€§

#### åˆæœŸï¼ˆå•æœºï¼‰

```
PostgreSQL + pgvector (å•å®ä¾‹)
Redis (å•å®ä¾‹)
Go MCP Server (å¯å¤šå®ä¾‹)
```

#### åæœŸï¼ˆåˆ†å¸ƒå¼ï¼‰

```
PostgreSQL ä¸»ä» + è¯»å†™åˆ†ç¦»
Redis Cluster
Milvus é›†ç¾¤ (æ›¿ä»£ pgvector)
```

### 6.3 å¯é æ€§

- PostgreSQL ACID äº‹åŠ¡ä¿è¯
- å®šæœŸå¤‡ä»½ï¼ˆæ¯æ—¥ï¼‰
- æ•…éšœè½¬ç§»ï¼ˆä¸»ä»åˆ‡æ¢ï¼‰
- ç›‘æ§å‘Šè­¦ï¼ˆå…³é”®æŒ‡æ ‡ï¼‰

### 6.4 ç¼“å­˜ç­–ç•¥

**Redis ç¼“å­˜è®¾è®¡ï¼š**

```go
// ç¼“å­˜ key æ„æˆ
cache_key = "search:{library_id}:{query_hash}"

// ç¼“å­˜å€¼
{
  "results": [...],
  "timestamp": "2024-12-01T12:00:00Z",
  "hit_count": 5
}

// ç¼“å­˜å‚æ•°
TTL: 24 å°æ—¶
é¢„çƒ­: å¦ï¼ˆæŒ‰éœ€ç¼“å­˜ï¼‰
æ·˜æ±°ç­–ç•¥: LRUï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨ï¼‰
```

**ç¼“å­˜åœºæ™¯ï¼š**
1. çƒ­é—¨æŸ¥è¯¢ç¼“å­˜ï¼ˆå‡å°‘å‘é‡æœç´¢è®¡ç®—ï¼‰
2. åº“åˆ—è¡¨ç¼“å­˜ï¼ˆå‡å°‘æ•°æ®åº“æŸ¥è¯¢ï¼‰
3. æ–‡æ¡£å—ç¼“å­˜ï¼ˆå‡å°‘æ•°æ®åº“ I/Oï¼‰

---

## ä¸ƒã€æµ‹è¯•ç­–ç•¥

### 7.1 å•å…ƒæµ‹è¯•ï¼ˆâ‰¥80% è¦†ç›–ç‡ï¼‰

```
âœ… æ–‡æ¡£è§£æ
  - Markdown è§£ææ­£ç¡®æ€§
  - PDF æ–‡æœ¬æå–å‡†ç¡®æ€§
  - DOCX æ ¼å¼å¤„ç†

âœ… åˆ†å—ç®—æ³•
  - 512 tokens åˆ†å—
  - 50 token é‡å 
  - ä»£ç å—å®Œæ•´æ€§

âœ… Embedding ç”Ÿæˆ
  - OpenAI API è°ƒç”¨
  - æœ¬åœ°æ¨¡å‹æ¨ç†
  - å‘é‡ç»´åº¦éªŒè¯

âœ… å‘é‡æ£€ç´¢
  - ç›¸ä¼¼åº¦è®¡ç®—
  - Top-K æ’åº
  - ç¼“å­˜å‘½ä¸­ç‡

âœ… MCP å·¥å…·
  - search-libraries åº“åŒ¹é…
  - get-library-docs æ–‡æ¡£è¿”å›
```

### 7.2 é›†æˆæµ‹è¯•

```
âœ… å®Œæ•´ä¸Šä¼ æµç¨‹
  æ–‡æ¡£ä¸Šä¼  â†’ è§£æ â†’ åˆ†å— â†’ Embedding â†’ å­˜å‚¨

âœ… å®Œæ•´æ£€ç´¢æµç¨‹
  æŸ¥è¯¢ â†’ å‘é‡ç”Ÿæˆ â†’ æ£€ç´¢ â†’ é‡æ’åº â†’ ç¼“å­˜

âœ… MCP ç«¯åˆ°ç«¯
  IDE è¯·æ±‚ â†’ MCP å¤„ç† â†’ è¿”å›ç»“æœ
```

### 7.3 ç«¯åˆ°ç«¯æµ‹è¯•

```
âœ… çœŸå®åœºæ™¯éªŒè¯
  1. ä¸Šä¼  React æ–‡æ¡£
  2. CoStrict IDE é…ç½® MCP
  3. æé—® "å¦‚ä½•ä½¿ç”¨ hooks"
  4. éªŒè¯è¿”å›çš„æ–‡æ¡£å‡†ç¡®æ€§
  5. éªŒè¯ä»£ç ç”Ÿæˆè´¨é‡æå‡
```

---

## å…«ã€MVP èŒƒå›´ï¼ˆç¬¬ä¸€é˜¶æ®µ 2 å‘¨ï¼‰

### P0ï¼ˆå¿…é¡»ï¼‰

- âœ… MCP Server åŸºç¡€æ¡†æ¶ï¼ˆä¸¤ä¸ªå·¥å…·ï¼‰
- âœ… PostgreSQL + pgvector é›†æˆ
- âœ… Markdown + PDF è§£æ
- âœ… å‘é‡åŒ–æµç¨‹ï¼ˆOpenAI Embeddingï¼‰
- âœ… åŸºç¡€å‘é‡æ£€ç´¢
- âœ… ç®€å• Web ç•Œé¢ï¼ˆä¸Šä¼  + æµ‹è¯•ï¼‰
- âœ… Docker Compose éƒ¨ç½²

### P1ï¼ˆç¬¬äºŒé˜¶æ®µ 1 å‘¨ï¼‰

- âœ… æ··åˆæ£€ç´¢ï¼ˆå‘é‡ + å…³é”®è¯ï¼‰
- âœ… ç®€åŒ–é‡æ’åºï¼ˆ3 æŒ‡æ ‡ï¼‰
- âœ… ç‰ˆæœ¬ç®¡ç†
- âœ… Redis ç¼“å­˜

### P2ï¼ˆç¬¬ä¸‰é˜¶æ®µ 1 å‘¨ï¼‰

- âš ï¸ DOCX/Swagger æ”¯æŒ
- âš ï¸ é«˜çº§é‡æ’åº
- âš ï¸ ç›‘æ§å‘Šè­¦

---

## åäº”ã€æœ€ç»ˆæ¶æ„ç¡®è®¤

### 15.1 é¡¹ç›®æ¶æ„

**å•ä¸€é¡¹ç›®ï¼Œåˆ†å±‚æ¶æ„ï¼ˆå‚è€ƒ blog é¡¹ç›®ï¼‰**

```
go-mcp-context/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ main.go                 # åº”ç”¨å…¥å£
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ api/                    # API æ¥å£å±‚
â”‚   â”‚   â”œâ”€â”€ mcp/                # MCP å·¥å…·æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ search.go       # search-libraries å·¥å…·
â”‚   â”‚   â”‚   â””â”€â”€ docs.go         # get-library-docs å·¥å…·
â”‚   â”‚   â””â”€â”€ web/                # å‰ç«¯ API æ¥å£
â”‚   â”‚       â”œâ”€â”€ library.go      # åº“ç®¡ç† API
â”‚   â”‚       â”œâ”€â”€ document.go     # æ–‡æ¡£ç®¡ç† API
â”‚   â”‚       â””â”€â”€ search.go       # æœç´¢æµ‹è¯• API
â”‚   â”œâ”€â”€ service/                # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ library.go          # åº“ç®¡ç†æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ search.go           # æœç´¢æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ mcp.go              # MCP æœåŠ¡
â”‚   â”‚   â””â”€â”€ document.go         # æ–‡æ¡£å¤„ç†æœåŠ¡
â”‚   â”œâ”€â”€ model/                  # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ library.go
â”‚   â”‚   â”œâ”€â”€ document.go
â”‚   â”‚   â””â”€â”€ chunk.go
â”‚   â”œâ”€â”€ router/                 # è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ mcp.go              # MCP è·¯ç”±
â”‚   â”‚   â””â”€â”€ web.go              # å‰ç«¯ API è·¯ç”±
â”‚   â””â”€â”€ initialize/             # åˆå§‹åŒ–
â”‚       â”œâ”€â”€ gorm.go
â”‚       â”œâ”€â”€ redis.go
â”‚       â””â”€â”€ embedding.go
â”œâ”€â”€ pkg/
â”‚   â”œâ”€â”€ config/                 # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ conf.go
â”‚   â”‚   â””â”€â”€ conf_postgres.go
â”‚   â”œâ”€â”€ global/                 # å…¨å±€å˜é‡
â”‚   â”œâ”€â”€ utils/                  # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ logger/                 # æ—¥å¿—
â”‚   â”œâ”€â”€ parser/                 # æ–‡æ¡£è§£æ
â”‚   â”‚   â”œâ”€â”€ parser.go           # interface
â”‚   â”‚   â”œâ”€â”€ markdown.go
â”‚   â”‚   â””â”€â”€ pdf.go
â”‚   â”œâ”€â”€ embedding/              # Embedding æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ service.go          # interface
â”‚   â”‚   â””â”€â”€ openai.go
â”‚   â”œâ”€â”€ vectorstore/            # å‘é‡å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ store.go            # interface
â”‚   â”‚   â””â”€â”€ postgres.go
â”‚   â”œâ”€â”€ cache/                  # ç¼“å­˜å±‚
â”‚   â”‚   â”œâ”€â”€ cache.go            # interface
â”‚   â”‚   â””â”€â”€ redis.go
â”‚   â”œâ”€â”€ ranker/                 # é‡æ’åº
â”‚   â”‚   â”œâ”€â”€ ranker.go           # interface
â”‚   â”‚   â””â”€â”€ simple.go
â”‚   â””â”€â”€ chunker/                # åˆ†å—
â”‚       â”œâ”€â”€ chunker.go          # interface
â”‚       â””â”€â”€ token_based.go
â”œâ”€â”€ web/                        # å‰ç«¯ï¼ˆVue 3ï¼‰
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”œâ”€â”€ LibraryPage.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ UploadPage.vue
â”‚   â”‚   â”‚   â””â”€â”€ SearchPage.vue
â”‚   â”‚   â”œâ”€â”€ App.vue
â”‚   â”‚   â””â”€â”€ main.ts
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ vite.config.ts
â”œâ”€â”€ configs/
â”‚   â”œâ”€â”€ config.yaml             # å¼€å‘é…ç½®
â”‚   â””â”€â”€ config.prod.yaml        # ç”Ÿäº§é…ç½®
â”œâ”€â”€ migrations/                 # æ•°æ®åº“è¿ç§»
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ flag/                   # CLI å‘½ä»¤è¡Œå·¥å…·
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â””â”€â”€ README.md
```

**ç†ç”±ï¼š**
- å•ä¸€é¡¹ç›®ï¼šMCP Server å’Œåç«¯é€»è¾‘ç´§å¯†è€¦åˆ
- åˆ†å±‚æ¶æ„ï¼šæ¸…æ™°çš„èŒè´£åˆ’åˆ†
- å‚è€ƒ blog é¡¹ç›®ï¼šå·²éªŒè¯çš„æœ€ä½³å®è·µ

---

### 15.2 æœ€ç»ˆç¡®è®¤æ¸…å•

| # | é¡¹ç›® | æ–¹æ¡ˆ | çŠ¶æ€ |
|---|------|------|------|
| 1 | é¡¹ç›®ç»“æ„ | å•ä¸€é¡¹ç›®ï¼Œåˆ†å±‚æ¶æ„ | âœ… |
| 2 | search-libraries | æ¨¡ç³ŠåŒ¹é… + å‘é‡æœç´¢ï¼Œé˜ˆå€¼ â‰¥80% | âœ… |
| 3 | get-library-docs | æ··åˆæœç´¢ + é‡æ’åº | âœ… |
| 4 | é‡æ’åºæƒé‡ | 0.5 + 0.3 + 0.2 | âœ… |
| 5 | è¾“å‡ºæ ¼å¼ | ç»“æ„åŒ– JSONï¼ˆåŒ…å«ç›¸å…³æ€§åˆ†æ•°ï¼‰ | âœ… |
| 6 | ç¼“å­˜ç­–ç•¥ | Redisï¼ŒTTL 24 å°æ—¶ï¼Œæ— é¢„çƒ­ | âœ… |
| 7 | æ–‡æ¡£çƒ­åº¦ | è®¿é—®è®¡æ•°ï¼Œæ— æ—¶é—´è¡°å‡ | âœ… |
| 8 | åˆ†é¡µ | MCP æ”¯æŒ page 1-10ï¼Œå‰ç«¯æ”¯æŒåˆ†é¡µ | âœ… |
| 9 | mode å‚æ•° | æ”¯æŒ code å’Œ info | âœ… |
| 10 | å‰ç«¯åŠŸèƒ½ | åº“ç®¡ç† + ä¸Šä¼  + æœç´¢æµ‹è¯• | âœ… |

---

### 15.3 å…³é”®è®¾è®¡å†³ç­–

**å†³ç­– 1ï¼šæ··åˆæœç´¢ â†’ å‘é‡ + å…³é”®è¯ âœ…**

**ä¸ºä»€ä¹ˆï¼Ÿ**
- å‘é‡æœç´¢ï¼šæ•æ‰è¯­ä¹‰ç›¸ä¼¼æ€§
- å…³é”®è¯æœç´¢ï¼šç¡®ä¿ç²¾ç¡®åŒ¹é…
- æ··åˆæœç´¢ï¼šç»“åˆä¸¤è€…ä¼˜åŠ¿

**å®ç°ï¼š**
- å‘é‡æœç´¢ Top-50ï¼ˆcosine ç›¸ä¼¼åº¦ï¼‰
- å…³é”®è¯æœç´¢ Top-50ï¼ˆBM25 åˆ†æ•°ï¼‰
- åˆå¹¶å»é‡åé‡æ’åº

---

**å†³ç­– 2ï¼šEmbedding â†’ OpenAI text-embedding-3-small âœ…**

**ä¸ºä»€ä¹ˆä¸ç”¨æœ¬åœ°æ¨¡å‹ï¼Ÿ**
- æˆæœ¬æä½ï¼ˆ$0.02/1M tokensï¼Œæ¯æœˆå‡ å…ƒï¼‰
- æ€§èƒ½ä¼˜å¼‚ï¼Œæ¥è¿‘ GPT-4 æ°´å¹³
- å¯éšæ—¶åˆ‡æ¢åˆ°æœ¬åœ° bge-m3ï¼ˆå…¼å®¹æ€§å¥½ï¼‰

**æˆæœ¬ä¼°ç®—ï¼š**
- å¤„ç† 1000 ä¸ªæ–‡æ¡£ï¼ˆ5000 tokens/ä¸ªï¼‰ï¼š$0.10
- æ¯å¤© 10000 æ¬¡æŸ¥è¯¢ï¼š$0.02/å¤©ï¼ˆ$0.60/æœˆï¼‰

---

**å†³ç­– 3ï¼šé‡æ’åº â†’ ç®€åŒ–ç‰ˆ 3 æŒ‡æ ‡ âœ…**

**ä¸ºä»€ä¹ˆä¸ç”¨ Context7 çš„ 5 æŒ‡æ ‡ï¼Ÿ**
- MVP é˜¶æ®µä¼˜å…ˆå¿«é€Ÿä¸Šçº¿
- 3 æŒ‡æ ‡å·²èƒ½æ»¡è¶³ 80% åœºæ™¯
- åæœŸå¯å‡çº§åˆ° 5 æŒ‡æ ‡

**3 æŒ‡æ ‡ç»„æˆï¼š**
- å‘é‡ç›¸ä¼¼åº¦ï¼š50%ï¼ˆè¯­ä¹‰æœç´¢æ˜¯æ ¸å¿ƒï¼‰
- BM25 åˆ†æ•°ï¼š30%ï¼ˆå…³é”®è¯åŒ¹é…è¡¥å……ï¼‰
- æ–‡æ¡£çƒ­åº¦ï¼š20%ï¼ˆè¾…åŠ©æ’åºå› å­ï¼‰

---

**å†³ç­– 4ï¼šå‰ç«¯åŠŸèƒ½ â†’ ç®€å•åº“åˆ—è¡¨ âœ…**

**ä¸ºä»€ä¹ˆä¸éœ€è¦ Popular/Trending/Recentï¼Ÿ**
- MVP é˜¶æ®µç®€åŒ–åŠŸèƒ½
- ç®€å•åˆ—è¡¨è¶³å¤Ÿåº“ç®¡ç†éœ€æ±‚
- åæœŸå¯æ·»åŠ åˆ†ç±»åŠŸèƒ½

---

**å†³ç­– 5ï¼šç¼“å­˜ç­–ç•¥ â†’ æŒ‰éœ€ç¼“å­˜ï¼Œæ— é¢„çƒ­ âœ…**

**ä¸ºä»€ä¹ˆä¸é¢„çƒ­ï¼Ÿ**
- æŸ¥è¯¢å¤šæ ·åŒ–ï¼Œé¢„çƒ­æ•ˆæœæœ‰é™
- æŒ‰éœ€ç¼“å­˜ç®€å•é«˜æ•ˆ
- 24 å°æ—¶ TTL å¹³è¡¡æ–°é²œåº¦å’Œæ€§èƒ½

---

## åå…­ã€å®ç°ä¼˜å…ˆçº§

### 16.1 MVP é˜¶æ®µï¼ˆç¬¬ 1-2 å‘¨ï¼‰- 29 ä¸ªæ–¹æ³•
- âœ… DocumentParser (Markdown, PDF) - 5 ä¸ªæ–¹æ³•
- âœ… EmbeddingService (OpenAI) - 6 ä¸ªæ–¹æ³•
- âœ… VectorStore (PostgreSQL) - 8 ä¸ªæ–¹æ³•
- âœ… Cache (Redis) - 6 ä¸ªæ–¹æ³•
- âœ… Chunker (TokenBased) - 4 ä¸ªæ–¹æ³•

### 16.2 ç¬¬äºŒé˜¶æ®µï¼ˆç¬¬ 3-4 å‘¨ï¼‰- 17 ä¸ªæ–¹æ³•
- âœ… Ranker (Simple) - 5 ä¸ªæ–¹æ³•
- âœ… Database (PostgreSQL) - 12 ä¸ªæ–¹æ³•

---

## åä¸ƒã€å·¥ä½œé‡ä¼°ç®—

| æ¨¡å— | å·¥ä½œé‡ï¼ˆäººå¤©ï¼‰ | å¤‡æ³¨ |
|------|----------------|------|
| MCP Server å®ç° | 3-5 | åŸºäº mcp-golang |
| æ–‡æ¡£è§£æå¼•æ“ | 8-10 | å¤šæ ¼å¼æ”¯æŒ |
| å‘é‡åŒ– + æ£€ç´¢ | 7-10 | PostgreSQL + pgvector |
| å‰ç«¯ç®¡ç†ç•Œé¢ | 8-10 | React ç•Œé¢ |
| æµ‹è¯• + ä¼˜åŒ– | 5-7 | å•å…ƒ + é›†æˆ + E2E |
| **æ€»è®¡** | **31-42 å¤©** | çº¦ 6-8 å‘¨ |

---

## åå…«ã€é¡¹ç›®è®¡åˆ’ï¼ˆæŒ‰å¤©æ•°ï¼‰

### ç¬¬ 1 å¤©ï¼šé¡¹ç›®åˆå§‹åŒ–

- [ ] åˆ›å»º Go åç«¯é¡¹ç›®ç»“æ„
- [ ] åˆ›å»º React å‰ç«¯é¡¹ç›®ç»“æ„
- [ ] ç¼–å†™ docker-compose.yml
- [ ] ç¼–å†™ README å’Œ ARCHITECTURE.md

**äº¤ä»˜ç‰©ï¼š** é¡¹ç›®éª¨æ¶ + æ–‡æ¡£

### ç¬¬ 2-3 å¤©ï¼šMCP Server å®ç°

- [ ] é›†æˆ mcp-golang SDK
- [ ] å®ç° search-libraries å·¥å…·
- [ ] å®ç° get-library-docs å·¥å…·
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•

**äº¤ä»˜ç‰©ï¼š** å¯è¿è¡Œçš„ MCP Server

### ç¬¬ 4-5 å¤©ï¼šæ•°æ®åº“å’Œ Embedding

- [ ] PostgreSQL + pgvector é›†æˆ
- [ ] GORM æ¨¡å‹å®šä¹‰
- [ ] OpenAI Embedding é›†æˆ
- [ ] å‘é‡å­˜å‚¨å’Œæ£€ç´¢å®ç°

**äº¤ä»˜ç‰©ï¼š** å‘é‡æ£€ç´¢åŠŸèƒ½

### ç¬¬ 6-7 å¤©ï¼šæ–‡æ¡£å¤„ç†

- [ ] Markdown è§£æ
- [ ] PDF è§£æ
- [ ] åˆ†å—ç®—æ³•å®ç°
- [ ] æ–‡æ¡£ä¸Šä¼  API

**äº¤ä»˜ç‰©ï¼š** æ–‡æ¡£å¤„ç†æµç¨‹

### ç¬¬ 8-9 å¤©ï¼šå‰ç«¯å’Œé›†æˆ

- [ ] Vue 3 å‰ç«¯ç•Œé¢
- [ ] æ–‡æ¡£ä¸Šä¼ åŠŸèƒ½
- [ ] æ£€ç´¢æµ‹è¯•ç•Œé¢
- [ ] é›†æˆæµ‹è¯•

**äº¤ä»˜ç‰©ï¼š** å®Œæ•´çš„ Web ç•Œé¢

### ç¬¬ 10 å¤©ï¼šéƒ¨ç½²å’ŒéªŒè¯

- [ ] Docker éƒ¨ç½²éªŒè¯
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•
- [ ] æ–‡æ¡£å®Œå–„

**äº¤ä»˜ç‰©ï¼š** å¯éƒ¨ç½²çš„ç³»ç»Ÿ

---

## åä¹ã€æ•°æ®åº“ Schemaï¼ˆå®Œæ•´è®¾è®¡ï¼‰

### 19.1 åº“è¡¨

```sql
CREATE TABLE libraries (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    version VARCHAR(50) NOT NULL,
    description TEXT,
    metadata JSONB,                         -- åº“çš„é¢å¤–ä¿¡æ¯
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    status VARCHAR(20) DEFAULT 'active' CHECK (status IN ('active', 'archived', 'deleted')),
    deleted_at TIMESTAMP NULL,
    UNIQUE(name, version),
    INDEX idx_name_version (name, version),
    INDEX idx_status (status)
);
```

**å­—æ®µè¯´æ˜ï¼š**
- `metadata` - å­˜å‚¨åº“çš„ä½œè€…ã€URLã€æ ‡ç­¾ç­‰ä¿¡æ¯
- `status` - çŠ¶æ€ï¼ˆactiveã€archivedã€deletedï¼‰
- `deleted_at` - åˆ é™¤æ—¶é—´æˆ³
- `updated_at` - ç‰ˆæœ¬æ›´æ–°æ—¶é—´

---

### 19.2 æ–‡æ¡£è¡¨

```sql
CREATE TABLE documents (
    id SERIAL PRIMARY KEY,
    library_id INTEGER NOT NULL REFERENCES libraries(id) ON DELETE CASCADE,
    title VARCHAR(500),
    file_path TEXT NOT NULL,
    file_type VARCHAR(50),                  -- markdown, pdf, docx, swagger
    file_size INTEGER,                      -- æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
    chunk_count INTEGER DEFAULT 0,          -- åˆ†å—æ•°é‡
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    status VARCHAR(20) DEFAULT 'active' CHECK (status IN ('active', 'archived', 'deleted')),
    deleted_at TIMESTAMP NULL,
    INDEX idx_library_id (library_id),
    INDEX idx_created_at (created_at),
    INDEX idx_status (status)
);
```

**å­—æ®µè¯´æ˜ï¼š**
- `file_size` - ç”¨äºç›‘æ§å­˜å‚¨ä½¿ç”¨
- `chunk_count` - å¿«é€ŸæŸ¥è¯¢æ–‡æ¡£çš„åˆ†å—æ•°
- `status` - çŠ¶æ€ï¼ˆactiveã€archivedã€deletedï¼‰
- `deleted_at` - åˆ é™¤æ—¶é—´æˆ³

---

### 19.3 æ–‡æ¡£å—è¡¨ï¼ˆå¸¦å‘é‡ï¼‰

```sql
CREATE TABLE document_chunks (
    id SERIAL PRIMARY KEY,
    document_id INTEGER NOT NULL REFERENCES documents(id) ON DELETE CASCADE,
    library_id INTEGER NOT NULL REFERENCES libraries(id) ON DELETE CASCADE,
    chunk_index INTEGER NOT NULL,          -- å—åœ¨æ–‡æ¡£ä¸­çš„ä½ç½®
    chunk_text TEXT NOT NULL,
    tokens INTEGER,                         -- token æ•°é‡
    embedding vector(1536),                 -- OpenAI text-embedding-3-small
    metadata JSONB,                         -- å—çš„å…ƒæ•°æ®ï¼ˆæ ‡é¢˜ã€ä»£ç ç±»å‹ç­‰ï¼‰
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    status VARCHAR(20) DEFAULT 'active' CHECK (status IN ('active', 'archived', 'deleted')),
    deleted_at TIMESTAMP NULL,
    
    -- å‘é‡ç´¢å¼•ï¼ˆç”¨äºç›¸ä¼¼åº¦æœç´¢ï¼‰
    INDEX idx_chunks_embedding ON embedding USING hnsw (embedding vector_cosine_ops)
    WITH (m = 16, ef_construction = 64),
    
    -- å…¨æ–‡æœç´¢ç´¢å¼•ï¼ˆæ··åˆæ£€ç´¢ï¼‰
    INDEX idx_chunks_text ON chunk_text USING gin(to_tsvector('english', chunk_text)),
    
    -- æŸ¥è¯¢ä¼˜åŒ–ç´¢å¼•
    INDEX idx_library_id (library_id),
    INDEX idx_document_id (document_id),
    INDEX idx_chunk_index (chunk_index),
    INDEX idx_created_at (created_at),
    INDEX idx_status (status)
);
```

**å­—æ®µè¯´æ˜ï¼š**
- `tokens` - ç”¨äºæˆæœ¬è®¡ç®—å’Œæ€§èƒ½ç›‘æ§
- `metadata` - å­˜å‚¨å—çš„æ¥æºä¿¡æ¯ï¼ˆå¦‚ä»£ç è¯­è¨€ã€æ ‡é¢˜ç­‰ï¼‰
- `status` - çŠ¶æ€ï¼ˆactiveã€archivedã€deletedï¼‰
- å¤šä¸ªç´¢å¼•æ”¯æŒä¸åŒçš„æŸ¥è¯¢æ¨¡å¼

---

### 19.4 æœç´¢ç¼“å­˜è¡¨ï¼ˆP1 é˜¶æ®µï¼‰

```sql
CREATE TABLE search_cache (
    id SERIAL PRIMARY KEY,
    query_hash VARCHAR(64) UNIQUE NOT NULL,  -- æŸ¥è¯¢çš„ hash å€¼
    library_id INTEGER NOT NULL REFERENCES libraries(id) ON DELETE CASCADE,
    results JSONB NOT NULL,                  -- ç¼“å­˜çš„æœç´¢ç»“æœ
    hit_count INTEGER DEFAULT 0,             -- ç¼“å­˜å‘½ä¸­æ¬¡æ•°
    ttl TIMESTAMP NOT NULL,                  -- ç¼“å­˜è¿‡æœŸæ—¶é—´
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    
    INDEX idx_query_hash (query_hash),
    INDEX idx_library_id (library_id),
    INDEX idx_ttl (ttl)
);
```

**ç”¨é€”ï¼š**
- ç¼“å­˜çƒ­é—¨æŸ¥è¯¢çš„ç»“æœ
- å‡å°‘å‘é‡æœç´¢çš„è®¡ç®—é‡
- æé«˜æ£€ç´¢æ€§èƒ½

---

### 19.5 ç»Ÿè®¡è¡¨ï¼ˆå¯é€‰ï¼ŒP2 é˜¶æ®µï¼‰

```sql
CREATE TABLE statistics (
    id SERIAL PRIMARY KEY,
    library_id INTEGER REFERENCES libraries(id) ON DELETE CASCADE,
    metric_name VARCHAR(100),               -- æŒ‡æ ‡åç§°
    metric_value BIGINT,                    -- æŒ‡æ ‡å€¼
    recorded_at TIMESTAMP DEFAULT NOW(),
    
    INDEX idx_library_id (library_id),
    INDEX idx_metric_name (metric_name),
    INDEX idx_recorded_at (recorded_at)
);
```

**ç”¨é€”ï¼š**
- è®°å½•ç³»ç»Ÿç»Ÿè®¡ä¿¡æ¯
- æ”¯æŒæ€§èƒ½ç›‘æ§å’Œåˆ†æ

---

### 19.6 æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬

```sql
-- å¯ç”¨ pgvector æ‰©å±•
CREATE EXTENSION IF NOT EXISTS vector;

-- å¯ç”¨ UUID æ‰©å±•ï¼ˆå¯é€‰ï¼Œç”¨äºç”Ÿæˆ IDï¼‰
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";

-- åˆ›å»ºæ‰€æœ‰è¡¨
-- ï¼ˆä¸Šé¢çš„è¡¨å®šä¹‰ï¼‰

-- åˆ›å»ºè§†å›¾ï¼šåº“çš„ç»Ÿè®¡ä¿¡æ¯
CREATE VIEW library_stats AS
SELECT 
    l.id,
    l.name,
    l.version,
    COUNT(DISTINCT d.id) as document_count,
    COUNT(dc.id) as chunk_count,
    SUM(dc.tokens) as total_tokens,
    l.created_at,
    l.updated_at
FROM libraries l
LEFT JOIN documents d ON l.id = d.library_id AND d.status = 'active'
LEFT JOIN document_chunks dc ON d.id = dc.document_id AND dc.status = 'active'
GROUP BY l.id;

-- åˆ›å»ºè§†å›¾ï¼šæ–‡æ¡£çš„ç»Ÿè®¡ä¿¡æ¯
CREATE VIEW document_stats AS
SELECT 
    d.id,
    d.library_id,
    d.title,
    COUNT(dc.id) as chunk_count,
    SUM(dc.tokens) as total_tokens,
    d.created_at,
    d.updated_at
FROM documents d
LEFT JOIN document_chunks dc ON d.id = dc.document_id AND dc.status = 'active'
GROUP BY d.id;
```

---

### 19.7 è¡¨è®¾è®¡æ€»ç»“

| è¡¨å | ç”¨é€” | è¡Œæ•°ä¼°è®¡ | å¤§å°ä¼°è®¡ |
|------|------|--------|--------|
| libraries | åº“ç®¡ç† | 100-1000 | 1-10 MB |
| documents | æ–‡æ¡£ç®¡ç† | 10K-100K | 10-100 MB |
| document_chunks | å‘é‡å­˜å‚¨ | 1M-10M | 1-10 GB |
| search_cache | æŸ¥è¯¢ç¼“å­˜ | 10K-100K | 100-500 MB |
| statistics | ç»Ÿè®¡æ•°æ® | 1K-10K | 10-50 MB |

---

### 19.8 æ€§èƒ½ä¼˜åŒ–å»ºè®®

#### 1. åˆ†åŒºç­–ç•¥ï¼ˆå¤§æ•°æ®é‡æ—¶ï¼‰
```sql
-- æŒ‰ library_id åˆ†åŒº
CREATE TABLE document_chunks_partitioned (
    ...
) PARTITION BY HASH (library_id);
```

#### 2. å®šæœŸæ¸…ç†
```sql
-- æ¸…ç†å·²åˆ é™¤çš„æ•°æ®ï¼ˆæ¯å‘¨æ‰§è¡Œï¼‰
DELETE FROM document_chunks WHERE status = 'deleted' AND deleted_at < NOW() - INTERVAL '30 days';
DELETE FROM documents WHERE status = 'deleted' AND deleted_at < NOW() - INTERVAL '30 days';
DELETE FROM libraries WHERE status = 'deleted' AND deleted_at < NOW() - INTERVAL '30 days';
```

#### 3. ç´¢å¼•ç»´æŠ¤
```sql
-- å®šæœŸé‡å»ºç´¢å¼•ï¼ˆæ¯æœˆæ‰§è¡Œï¼‰
REINDEX INDEX idx_chunks_embedding;
REINDEX INDEX idx_chunks_text;
```

#### 4. ç»Ÿè®¡ä¿¡æ¯æ›´æ–°
```sql
-- æ›´æ–°è¡¨ç»Ÿè®¡ï¼ˆæ¯å¤©æ‰§è¡Œï¼‰
ANALYZE libraries;
ANALYZE documents;
ANALYZE document_chunks;
```

---

## äºŒåã€å…³é”® API è®¾è®¡

### MCP HTTP ç«¯ç‚¹

**MCP Server éœ€è¦æš´éœ²çš„ HTTP ç«¯ç‚¹ï¼Œä¾› IDEï¼ˆCursorã€VSCode ç­‰ï¼‰è°ƒç”¨**

#### 1. å·¥å…·åˆ—è¡¨ç«¯ç‚¹

```
GET /mcp/tools

Response:
{
  "tools": [
    {
      "name": "search-libraries",
      "description": "Search for libraries by name",
      "inputSchema": {
        "type": "object",
        "properties": {
          "libraryName": {
            "type": "string",
            "description": "Library name to search for"
          }
        },
        "required": ["libraryName"]
      }
    },
    {
      "name": "get-library-docs",
      "description": "Get documentation for a library",
      "inputSchema": {
        "type": "object",
        "properties": {
          "context7CompatibleLibraryID": {
            "type": "string",
            "description": "Library ID (e.g., /react/18.3.0)"
          },
          "mode": {
            "type": "string",
            "enum": ["code", "info"],
            "description": "Documentation mode"
          },
          "topic": {
            "type": "string",
            "description": "Topic to focus on (optional)"
          },
          "page": {
            "type": "integer",
            "minimum": 1,
            "maximum": 10,
            "description": "Page number for pagination"
          }
        },
        "required": ["context7CompatibleLibraryID"]
      }
    }
  ]
}
```

#### 2. å·¥å…·è°ƒç”¨ç«¯ç‚¹

```
POST /mcp
Content-Type: application/json
Authorization: Bearer JWT_TOKEN

Request Body (JSON-RPC 2.0):
{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "tools/call",
  "params": {
    "name": "search-libraries",
    "arguments": {
      "libraryName": "react"
    }
  }
}

Response:
{
  "jsonrpc": "2.0",
  "id": 1,
  "result": {
    "content": [
      {
        "type": "text",
        "text": "Available Libraries:\n\n1. React\n   ID: /react/18.3.0\n   Versions: [18.2.0, 18.3.0]\n   Snippets: 150\n   Score: 95"
      }
    ]
  }
}
```

#### 3. å¥åº·æ£€æŸ¥ç«¯ç‚¹

```
GET /mcp/health

Response:
{
  "status": "ok",
  "version": "1.0.0",
  "timestamp": "2024-12-01T12:00:00Z"
}
```

#### 4. IDE é…ç½®æ–‡ä»¶ç¤ºä¾‹

**ç”¨æˆ·éœ€è¦åœ¨ IDE çš„ MCP é…ç½®ä¸­æ·»åŠ ï¼ˆå¦‚ Cursor çš„ `~/.cursor/mcp.json`ï¼‰ï¼š**

```json
{
  "mcpServers": {
    "go-mcp-context": {
      "type": "streamable-http",
      "url": "http://localhost:8080/mcp",
      "headers": {
        "Authorization": "Bearer YOUR_JWT_TOKEN"
      }
    }
  }
}
```

**æˆ–è€…å¯¹äºç”Ÿäº§ç¯å¢ƒï¼ˆå†…ç½‘éƒ¨ç½²ï¼‰ï¼š**

```json
{
  "mcpServers": {
    "go-mcp-context": {
      "type": "streamable-http",
      "url": "http://internal-server:8080/mcp",
      "headers": {
        "Authorization": "Bearer YOUR_JWT_TOKEN"
      }
    }
  }
}
```

---

### æ–‡æ¡£ä¸Šä¼  API

```
POST /api/documents/upload
Content-Type: multipart/form-data

Parameters:
  - file: File (PDF/DOCX/MD/Swagger)
  - library_name: string
  - library_version: string
  - description: string (optional)

Response:
{
  "code": 0,
  "data": {
    "document_id": 123,
    "library_id": 456,
    "chunks_count": 50,
    "status": "processing"
  },
  "msg": "Document uploaded successfully"
}
```

### å‰ç«¯ Web API

#### åº“ç®¡ç† API

**åˆ—è¡¨åº“**
```
GET /api/v1/libraries

Response:
{
  "code": 0,
  "data": [
    {
      "id": 1,
      "name": "react",
      "version": "18.3.0",
      "description": "A JavaScript library for building user interfaces",
      "document_count": 50,
      "chunk_count": 1000,
      "total_tokens": 500000,
      "created_at": "2024-12-01T12:00:00Z",
      "updated_at": "2024-12-01T12:00:00Z"
    }
  ],
  "msg": "Success"
}
```

**åˆ é™¤åº“**
```
DELETE /api/v1/libraries/:id

Response:
{
  "code": 0,
  "data": null,
  "msg": "Library deleted successfully"
}
```

---

#### æ–‡æ¡£ä¸Šä¼  API

**ä¸Šä¼ æ–‡æ¡£ï¼ˆSSE å®æ—¶è¿›åº¦ï¼‰**
```
POST /api/v1/documents/upload
Content-Type: multipart/form-data

Parameters:
  - file: File (PDF/DOCX/MD/Swagger)
  - library_name: string
  - library_version: string
  - description: string (optional)

Response (SSE Stream):
data: {"type":"start","document_id":"doc_123","filename":"react.pdf"}
data: {"type":"step_progress","step":"parsing","progress":100,"message":"æ–‡æœ¬è§£æå®Œæˆ"}
data: {"type":"step_progress","step":"chunking","progress":100,"message":"åˆ†å—å®Œæˆï¼Œå…± 250 å—"}
data: {"type":"step_progress","step":"embedding","progress":50,"message":"æ­£åœ¨ç”Ÿæˆ Embedding (125/250)"}
data: {"type":"step_progress","step":"embedding","progress":100,"message":"Embedding ç”Ÿæˆå®Œæˆ"}
data: {"type":"step_progress","step":"storing","progress":100,"message":"å­˜å‚¨åˆ°æ•°æ®åº“å®Œæˆ"}
data: {"type":"completed","document_id":"doc_123","chunks_count":250,"tokens_count":125000}
```

---

#### æœç´¢æµ‹è¯• API

**æœç´¢æ–‡æ¡£**
```
POST /api/v1/search
Content-Type: application/json

Body:
{
  "library_id": 1,
  "query": "hooks",
  "page": 1,
  "limit": 10
}

Response:
{
  "code": 0,
  "data": {
    "results": [
      {
        "chunk_id": "chunk_123",
        "content": "useEffect is a React Hook that lets you perform side effects...",
        "source": "react/18.3.0/hooks.md",
        "similarity_score": 0.92,
        "relevance_score": 0.88,
        "metadata": {
          "line_start": 100,
          "line_end": 120
        }
      }
    ],
    "total": 50,
    "page": 1,
    "limit": 10,
    "has_more": true
  },
  "msg": "Success"
}
```


## äºŒåä¸€ã€ç¯å¢ƒé…ç½®

### å¼€å‘ç¯å¢ƒ

```bash
# Go ç‰ˆæœ¬
go version go1.21+

# ä¾èµ–
- github.com/metoro-io/mcp-golang
- gorm.io/gorm
- gorm.io/driver/postgres
- github.com/pgvector/pgvector-go
- github.com/gin-gonic/gin
- github.com/redis/go-redis/v9

# æ–‡æ¡£è§£æ
- code.sajari.com/docconv
- github.com/gomarkdown/markdown
- github.com/go-openapi/spec

# Embedding
- github.com/sashabaranov/go-openai
```

### éƒ¨ç½²ç¯å¢ƒ

å¤ç”¨go_blog/docker-compose.base.ymlä¸­çš„postgreså’Œredis

---

## äºŒåäºŒã€Interface è®¾è®¡è§„åˆ’

### 22.1 æ ¸å¿ƒ Interface æ¸…å•

#### ğŸ”´ P0 å¿…é¡»ï¼ˆMVP é˜¶æ®µï¼‰

**1. DocumentParser - æ–‡æ¡£è§£æï¼ˆ5 ä¸ªæ–¹æ³•ï¼‰

```go
type DocumentParser interface {
    // æ ¸å¿ƒæ–¹æ³•
    Parse(filePath string) (string, error)  // è¿”å›çº¯æ–‡æœ¬
    
    // å…ƒæ•°æ®æ–¹æ³•
    GetFormat() string                      // markdown, pdf, docx, swagger
    GetSupportedExtensions() []string
    
    // éªŒè¯æ–¹æ³•
    CanParse(filePath string) bool
    ValidateFile(filePath string) error
}
```

**ä¸ºä»€ä¹ˆç®€åŒ–ï¼š**
- ç§»é™¤ `ParseWithMetadata`ã€`ExtractCodeBlocks`ï¼ˆMVP ä¸éœ€è¦ï¼‰
- ä¿ç•™æ ¸å¿ƒçš„æ–‡æœ¬æå–èƒ½åŠ›
- å…ƒæ•°æ®é€šè¿‡ Chunk çš„ metadata å­—æ®µå­˜å‚¨

**ä¸ºä»€ä¹ˆï¼š** éœ€è¦æ”¯æŒå¤šç§æ–‡æ¡£æ ¼å¼ï¼Œæ¯ç§æ ¼å¼çš„è§£æé€»è¾‘å®Œå…¨ä¸åŒ

---

**2. EmbeddingService - Embedding ç”Ÿæˆï¼ˆ6 ä¸ªæ–¹æ³•ï¼‰

```go
type EmbeddingService interface {
    // æ ¸å¿ƒæ–¹æ³•
    Embed(texts []string) ([][]float32, error)
    
    // å…ƒæ•°æ®æ–¹æ³•
    GetDimension() int                      // 1536 (OpenAI) æˆ– 1024 (bge-m3)
    GetModelName() string
    
    // æ‰¹å¤„ç†ï¼ˆæ€§èƒ½å…³é”®ï¼‰
    EmbedBatch(texts []string, batchSize int) ([][]float32, error)
    
    // éªŒè¯æ–¹æ³•
    ValidateInput(text string) error
    IsHealthy() bool
}
```

**ä¸ºä»€ä¹ˆç®€åŒ–ï¼š**
- ç§»é™¤ `EmbedOne`ï¼ˆç”¨ `Embed([]string{text})` ä»£æ›¿ï¼‰
- ç§»é™¤ `GetMaxTokens`ã€`EmbedWithMetadata`ã€`GetCost`ã€`GetLatency`ï¼ˆMVP ä¸éœ€è¦ï¼‰
- ä¿ç•™æ‰¹å¤„ç†ï¼ˆæ–‡æ¡£ä¸Šä¼ æ—¶éœ€è¦æ‰¹é‡ embeddingï¼‰

**ä¸ºä»€ä¹ˆï¼š** 
- åˆæœŸç”¨ OpenAIï¼ˆæˆæœ¬ä½ã€æ€§èƒ½å¥½ï¼‰
- åæœŸå¯åˆ‡æ¢æœ¬åœ°æ¨¡å‹ï¼ˆå®Œå…¨éš”ç¦»ã€æ— æˆæœ¬ï¼‰
- ä¸¤ç§æ¨¡å‹å‘é‡ç»´åº¦ä¸åŒï¼ˆéœ€è¦æŠ½è±¡ï¼‰

---

**3. VectorStore - å‘é‡å­˜å‚¨ï¼ˆ8 ä¸ªæ–¹æ³•ï¼‰

```go
type VectorStore interface {
    // æ ¸å¿ƒæ–¹æ³•
    Store(libraryID string, chunks []Chunk, embeddings [][]float32) error
    Search(query []float32, libraryID string, limit int) ([]SearchResult, error)
    
    // åˆ é™¤æ–¹æ³•
    DeleteLibrary(libraryID string) error
    DeleteChunk(chunkID string) error
    
    // æŸ¥è¯¢æ–¹æ³•
    GetChunk(chunkID string) (*Chunk, error)
    GetChunksByLibrary(libraryID string) ([]Chunk, error)
    
    // ç»´æŠ¤æ–¹æ³•
    Health() error
}
```

**ä¸ºä»€ä¹ˆç®€åŒ–ï¼š**
- ç§»é™¤ `HybridSearch`ï¼ˆP1 é˜¶æ®µå†åŠ ï¼‰
- ç§»é™¤ `GetStats`ã€`Rebuild`ã€`Optimize`ï¼ˆè¿ç»´å·¥å…·ï¼Œä¸æ˜¯æ ¸å¿ƒï¼‰
- ä¿ç•™åŸºç¡€çš„ CRUD å’Œæœç´¢

---

**4. Cache - ç¼“å­˜å±‚ï¼ˆ6 ä¸ªæ–¹æ³•ï¼‰

```go
type Cache interface {
    // æ ¸å¿ƒæ–¹æ³•
    Get(key string) (interface{}, error)
    Set(key string, value interface{}, ttl time.Duration) error
    
    // åˆ é™¤æ–¹æ³•
    Delete(key string) error
    Clear() error
    
    // åŸå­æ“ä½œï¼ˆçƒ­é—¨æŸ¥è¯¢ç¼“å­˜ï¼‰
    Increment(key string, delta int64) (int64, error)
    
    // ç»´æŠ¤æ–¹æ³•
    Health() error
}
```

**ä¸ºä»€ä¹ˆç®€åŒ–ï¼š**
- ç§»é™¤ `GetMultiple`ã€`SetMultiple`ã€`DeleteMultiple`ï¼ˆMVP å•ä¸ªæ“ä½œè¶³å¤Ÿï¼‰
- ç§»é™¤ `Decrement`ã€`GetSize`ã€`GetStats`ã€`Flush`ï¼ˆä¸æ˜¯æ ¸å¿ƒï¼‰
- ä¿ç•™åŸºç¡€çš„ Get/Set/Delete å’ŒåŸå­æ“ä½œ

---

**5. Ranker - é‡æ’åºç®—æ³•**

```go
type Ranker interface {
    Rank(results []SearchResult) []SearchResult
    GetScores(result SearchResult) RankingScore
}

// å®ç°
- SimpleRanker (3 æŒ‡æ ‡ï¼šå‘é‡ç›¸ä¼¼åº¦ 70% + ä»£ç å®Œæ•´æ€§ 20% + æ ¼å¼è´¨é‡ 10%)
- AdvancedRanker (5 æŒ‡æ ‡ï¼š+ æ—¶æ•ˆæ€§ + ç›¸å…³æ€§)
- MLRanker (åæœŸï¼šåŸºäºæœºå™¨å­¦ä¹ )
```

**ä¸ºä»€ä¹ˆï¼š**
- MVP ç”¨ç®€åŒ–ç‰ˆï¼ˆ3 æŒ‡æ ‡ï¼‰
- åæœŸå‡çº§åˆ°é«˜çº§ç‰ˆï¼ˆ5 æŒ‡æ ‡ï¼‰
- å¯æ”¯æŒ ML æ¨¡å‹é‡æ’åº

---

**6. Chunker - æ–‡æ¡£åˆ†å—ï¼ˆ4 ä¸ªæ–¹æ³•ï¼‰

```go
type Chunker interface {
    // æ ¸å¿ƒæ–¹æ³•
    Chunk(text string) []Chunk
    
    // é…ç½®æ–¹æ³•
    GetChunkSize() int
    GetOverlap() int
    
    // éªŒè¯æ–¹æ³•
    ValidateChunk(chunk Chunk) error
}
```

**ä¸ºä»€ä¹ˆç®€åŒ–ï¼š**
- ç§»é™¤ `SetChunkSize`ã€`SetOverlap`ï¼ˆé…ç½®åœ¨åˆå§‹åŒ–æ—¶è®¾ç½®ï¼‰
- ç§»é™¤ `ChunkWithMetadata`ã€`ChunkByTokens`ï¼ˆMVP ç”¨å›ºå®šé…ç½®ï¼‰
- ä¿ç•™åŸºç¡€çš„åˆ†å—èƒ½åŠ›

**ä¸ºä»€ä¹ˆï¼š** ä¸åŒåˆ†å—ç­–ç•¥å¯¹æ£€ç´¢æ•ˆæœå½±å“å¤§ï¼Œéœ€è¦æ”¯æŒåˆ‡æ¢

---

**7. Database - æ•°æ®åº“æŠ½è±¡ï¼ˆ12 ä¸ªæ–¹æ³•ï¼‰

```go
type Database interface {
    // åº“ç®¡ç†ï¼ˆ5 ä¸ªï¼‰
    CreateLibrary(lib *Library) error
    GetLibrary(id string) (*Library, error)
    UpdateLibrary(lib *Library) error
    DeleteLibrary(id string) error
    ListLibraries() ([]*Library, error)
    
    // æ–‡æ¡£ç®¡ç†ï¼ˆ5 ä¸ªï¼‰
    CreateDocument(doc *Document) error
    GetDocument(id string) (*Document, error)
    DeleteDocument(id string) error
    ListDocuments(libraryID string) ([]*Document, error)
    UpdateDocument(doc *Document) error
    
    // ç»´æŠ¤ï¼ˆ2 ä¸ªï¼‰
    Health() error
    Migrate() error
}
```

**ä¸ºä»€ä¹ˆç®€åŒ–ï¼š**
- ç§»é™¤å—ç®¡ç†æ–¹æ³•ï¼ˆå—å­˜å‚¨åœ¨ VectorStore ä¸­ï¼‰
- ä¿ç•™åº“å’Œæ–‡æ¡£çš„ CRUD

**ä¸ºä»€ä¹ˆï¼š** æ”¯æŒä¸åŒæ•°æ®åº“åç«¯ï¼Œä¾¿äºè¿ç§»å’Œæ‰©å±•

---

#### ğŸŸ¢ P2 å¯é€‰ï¼ˆç¬¬ä¸‰é˜¶æ®µï¼‰

**8. Logger - æ—¥å¿—æŠ½è±¡ï¼ˆ6 ä¸ªæ–¹æ³•ï¼‰**

```go
type Logger interface {
    Debug(msg string, fields ...Field)
    Info(msg string, fields ...Field)
    Warn(msg string, fields ...Field)
    Error(msg string, fields ...Field)
    
    WithFields(fields ...Field) Logger
    Sync() error
}
```

---

**9. ConfigProvider - é…ç½®ç®¡ç†ï¼ˆ8 ä¸ªæ–¹æ³•ï¼‰**

```go
type ConfigProvider interface {
    GetString(key string) string
    GetInt(key string) int
    GetBool(key string) bool
    GetDuration(key string) time.Duration
    
    GetStringSlice(key string) []string
    GetStringMap(key string) map[string]interface{}
    
    Validate() error
    Watch(key string, callback func(interface{})) error
}
```

---

### 22.2 Interface è®¾è®¡åŸåˆ™

#### 1. æ–¹æ³•åˆ†ç±»
- **æ ¸å¿ƒæ–¹æ³•**ï¼š2-3 ä¸ªï¼ˆå¿…é¡»å®ç°ï¼‰
- **å…ƒæ•°æ®æ–¹æ³•**ï¼š2-4 ä¸ªï¼ˆæ”¯æŒæŸ¥è¯¢ï¼‰
- **é«˜çº§æ–¹æ³•**ï¼š1-3 ä¸ªï¼ˆå¯é€‰ä¼˜åŒ–ï¼‰
- **ç»´æŠ¤æ–¹æ³•**ï¼š1-3 ä¸ªï¼ˆè¿ç»´æ”¯æŒï¼‰
- **æ€»è®¡**ï¼š4-12 ä¸ªæ–¹æ³•

#### 2. ä¾èµ–æ³¨å…¥
```go
// âŒ ä¸å¥½ï¼šç¡¬ç¼–ç ä¾èµ–
type SearchService struct {
    embedding *OpenAIEmbedding
    store *PostgreSQLVectorStore
}

// âœ… å¥½ï¼šæ³¨å…¥ interface
type SearchService struct {
    embedding EmbeddingService
    store VectorStore
}
```

#### 3. å·¥å‚æ¨¡å¼
```go
// æ ¹æ®é…ç½®é€‰æ‹©å®ç°
func NewEmbeddingService(config Config) EmbeddingService {
    if config.EmbeddingType == "openai" {
        return NewOpenAIEmbedding(config.OpenAIKey)
    }
    return NewLocalEmbedding(config.ModelPath)
}
```

#### 4. é€‚é…å™¨æ¨¡å¼
```go
// åŒ…è£…ç¬¬ä¸‰æ–¹åº“
type DocconvPDFParser struct {
    // å†…éƒ¨ä½¿ç”¨ docconv åº“
}

func (p *DocconvPDFParser) Parse(filePath string) (string, error) {
    // è°ƒç”¨ docconvï¼Œè¿”å›çº¯æ–‡æœ¬
}
```

---


### 22.4 ä¾èµ–æ³¨å…¥ç¤ºä¾‹

```go
// åˆå§‹åŒ–æ‰€æœ‰æœåŠ¡
func NewApp(config Config) *App {
    // åˆ›å»ºå…·ä½“å®ç°
    embedding := NewEmbeddingService(config)
    vectorStore := NewVectorStore(config)
    cache := NewCache(config)
    ranker := NewRanker(config)
    
    // æ³¨å…¥åˆ°æœåŠ¡
    docService := NewDocumentService(
        embedding,
        vectorStore,
        cache,
    )
    
    searchService := NewSearchService(
        vectorStore,
        cache,
        ranker,
    )
    
    return &App{
        DocumentService: docService,
        SearchService: searchService,
    }
}
```

---

### 22.5 æ–¹æ³•æ€»è§ˆè¡¨ï¼ˆä¼˜åŒ–åï¼‰

| Interface | MVP | P1 | P2 | æ€»è®¡ | è¯´æ˜ |
|-----------|-----|-----|-----|------|------|
| DocumentParser | 5 | - | - | **5** | æ ¸å¿ƒæ–‡æœ¬æå– |
| EmbeddingService | 6 | - | - | **6** | æ‰¹å¤„ç†æ”¯æŒ |
| VectorStore | 8 | - | - | **8** | åŸºç¡€ CRUD + æœç´¢ |
| Cache | 6 | - | - | **6** | ç®€åŒ–ç¼“å­˜æ“ä½œ |
| Chunker | 4 | - | - | **4** | å›ºå®šé…ç½®åˆ†å— |
| Ranker | - | 5 | - | **5** | ç®€åŒ–é‡æ’åº |
| Database | - | 12 | - | **12** | åº“å’Œæ–‡æ¡£ç®¡ç† |
| Logger | - | - | 6 | **6** | åŸºç¡€æ—¥å¿— |
| ConfigProvider | - | - | 8 | **8** | é…ç½®ç®¡ç† |
| **æ€»è®¡** | **29** | **17** | **14** | **60** | ç›¸æ¯”åŸè®¾è®¡å‡å°‘ 31% |

---

## äºŒåä¸‰ã€æ€»ç»“

### ä½ è¦æ„å»ºä»€ä¹ˆ

**ä¸€ä¸ªä¼ä¸šçº§çš„ç§æœ‰åŒ–æ–‡æ¡£åº“ç³»ç»Ÿ**ï¼Œå…·æœ‰ï¼š

1. **MCP åè®®æ¥å£** - è®© CoStrict IDE æ— ç¼è°ƒç”¨
2. **å‘é‡æ£€ç´¢èƒ½åŠ›** - ç²¾å‡†åŒ¹é…ç”¨æˆ·æŸ¥è¯¢
3. **å¤šæ ¼å¼æ–‡æ¡£æ”¯æŒ** - é€‚åº”å„ç§æ–‡æ¡£ç±»å‹
4. **ç‰ˆæœ¬ç®¡ç†** - æ”¯æŒåº“çš„å¤šä¸ªç‰ˆæœ¬
5. **é«˜æ€§èƒ½** - 1 ç§’å†…è¿”å›ç»“æœ
6. **å†…ç½‘éƒ¨ç½²** - æ”¯æŒå®Œå…¨éš”ç¦»çš„ä¼ä¸šç¯å¢ƒ

### æ ¸å¿ƒä»·å€¼

è®© CoStrict ç”Ÿæˆçš„ä»£ç æ›´å‡†ç¡®ã€æ›´å®ç”¨ï¼Œæ˜¾è‘—å‡å°‘"å¹»è§‰"ç°è±¡ã€‚

### æˆåŠŸæŒ‡æ ‡

- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
- âœ… æ–‡æ¡£æ£€ç´¢å»¶è¿Ÿ < 1s
- âœ… æ–‡æ¡£æ›´æ–° < 1 åˆ†é’Ÿ
- âœ… CoStrict ä»£ç ç”Ÿæˆè´¨é‡æ˜æ˜¾æå‡
- âœ… æ”¯æŒå®¹å™¨åŒ–éƒ¨ç½²ï¼ˆDocker Compose / K8sï¼‰

---

## é™„å½•ï¼šæŠ€æœ¯å‚è€ƒ

### pgvector æ€§èƒ½åŸºå‡†

**æµ‹è¯•ç¯å¢ƒï¼š50M å‘é‡ï¼Œ768 ç»´**

| æŒ‡æ ‡ | PostgreSQL + pgvector | Qdrant | ä¼˜åŠ¿ |
|------|----------------------|--------|------|
| ååé‡ï¼ˆ99% å¬å›ï¼‰ | 471.57 QPS | 41.47 QPS | **11.4x** |
| P50 å»¶è¿Ÿ | 31.07 ms | 30.75 ms | Qdrant 1% |
| P95 å»¶è¿Ÿ | 60.42 ms | 36.73 ms | Qdrant 39% |
| P99 å»¶è¿Ÿ | 74.60 ms | 38.71 ms | Qdrant 48% |

### OpenAI Embedding å®šä»·

| æ¨¡å‹ | ä»·æ ¼ | ç»´åº¦ | æ€§èƒ½ |
|------|------|------|------|
| text-embedding-3-small | $0.02 / 1M tokens | 1536 | â­â­â­â­â­ |
| text-embedding-3-large | $0.13 / 1M tokens | 3072 | â­â­â­â­â­ |

### æ¨èå¼€æº Embedding æ¨¡å‹

| æ¨¡å‹ | ç»´åº¦ | å¤§å° | è¯­è¨€ | æ€§èƒ½ |
|------|------|------|------|------|
| BAAI/bge-m3 | 1024 | 2.3GB | 100+ | â­â­â­â­â­ |
| BAAI/bge-large-en-v1.5 | 1024 | 1.3GB | è‹±æ–‡ | â­â­â­â­â­ |
| sentence-transformers/all-MiniLM-L6-v2 | 384 | 80MB | è‹±æ–‡ | â­â­â­ |
